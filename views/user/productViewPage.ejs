<!DOCTYPE html>
<html lang="en">
<head>
  <%- include("../../views/partials/user/header") %>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
    }
    
    .header-top {
      background-color: #000;
      color: white;
      padding: 8px 0;
      text-align: center;
      position: relative;
    }
    
    .close-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }
    
    .navbar-brand {
      font-weight: bold;
      font-size: 24px;
    }
    
    .product-thumbs-container {
      display: flex;
      overflow-x: auto;
      padding: 5px 0;
      justify-content: flex-start;
      gap: 10px;
    }
    
    .product-thumb {
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 5px;
      cursor: pointer;
      width: 100px;
      height: 100px;
      overflow: hidden;
      transition: border 0.3s ease, transform 0.2s ease;
    }
    
    .product-thumb.active,
    .product-thumb:hover {
      border-color: #000;
      transform: scale(1.05);
    }
    
    .product-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .zoom-container {
      position: relative;
      width: 100%;
      height: 100%;
      aspect-ratio: 1 / 1;
      background-color: #f5f5f5;
      border-radius: 8px;
      margin-bottom: 10px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .zoom-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.3s ease, transform 0.5s ease;
    }
    
    .zoom-lens {
      position: absolute;
      border: 2px solid #fff;
      border-radius: 50%;
      cursor: crosshair;
      width: 300px;
      height: 300px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      background: rgba(255, 255, 255, 0.5);
    }
    
    .zoom-container:hover .zoom-lens {
      opacity: 1;
    }
    
    .image-popup {
      display: block;
      text-decoration: none;
    }
    
    .product-status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      text-align: center;
      margin-top: 10px;
      margin-bottom: 10px;
    }
    
    .status-in-stock {
      background-color: #e6f4ea;
      color: #28a745;
    }
    
    .status-out-of-stock {
      background-color: #f8e8e8;
      color: #dc3545;
    }
    
    .status-locked {
      background-color: #e9ecef;
      color: #6c757d;
    }
    
    .rating {
      color: #FFD700;
    }
    
    .old-price {
      text-decoration: line-through;
      color: #888;
    }
    
    .discount {
      background-color: #f8e8e8;
      color: #ff4d4d;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .spec-item {
      background-color: #f5f5f5;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 8px 15px;
      margin-right: 10px;
      margin-bottom: 10px;
      display: inline-block;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    .spec-item.active {
      background-color: #000;
      color: white;
      border-color: #000;
    }
    
    .quantity-input {
      width: 50px;
      text-align: center;
      border-radius: 8px;
      margin: 0 10px;
    }
    
    .btn-quantity {
      background-color: #f5f5f5;
      border: 1px solid #e5e5e5;
      width: 30px;
      height: 30px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    
    .btn-cart {
      background-color: #000;
      color: white;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: bold;
      flex: 1;
      margin-right: 10px;
    }
    
    .btn-buy-now {
      background-color: #ff4d4d;
      color: white;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: bold;
      flex: 1;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
    }
    
    .nav-tabs {
      border-bottom: none;
      flex-wrap: nowrap;
      overflow-x: auto;
    }
    
    .nav-tabs .nav-link {
      border: none;
      color: #888;
      font-weight: bold;
      white-space: nowrap;
    }
    
    .nav-tabs .nav-link.active {
      color: #000;
      border-bottom: 2px solid #000;
    }
    
    .review-card {
      background-color: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
    }
    
    .review-options {
      color: #888;
      cursor: pointer;
    }
    
    .verified-user {
      color: green;
      font-size: 12px;
      margin-left: 5px;
    }
    
    .product-card {
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      text-align: center;
      height: 100%;
    }
    
    .product-card img {
      max-width: 100%;
      height: auto;
    }
    
    .newsletter-box {
      background-color: #000;
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .footer {
      background-color: #f5f5f5;
      padding: 20px 0;
    }
    
    .social-icon {
      width: 30px;
      height: 30px;
      background-color: #000;
      color: white;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-right: 8px;
    }
    
    .container {
      padding-left: 10px;
      padding-right: 10px;
    }
    
    .container.mb-5 {
      margin-bottom: 2rem !important;
    }
    
    @media (max-width: 767px) {
      .product-thumbs-container {
        display: flex;
        overflow-x: auto;
        margin-bottom: 10px;
        justify-content: flex-start;
      }
      
      .product-thumb {
        min-width: 70px;
        margin-right: 10px;
        margin-bottom: 0;
      }
      
      .zoom-container {
        max-height: 400px;
      }
      
      .zoom-image {
        height: 400px;
      }
      
      .zoom-lens {
        display: none !important;
      }
      
      .product-status {
        font-size: 13px;
        padding: 5px 10px;
      }
      
      .spec-section {
        flex-direction: column;
      }
      
      .quantity-section {
        flex-direction: column;
        align-items: flex-start !important;
      }
      
      .quantity-controls {
        margin-bottom: 10px;
      }
      
      .action-buttons {
        flex-direction: column;
        gap: 10px;
      }
      
      .btn-cart, .btn-buy-now {
        margin-right: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Breadcrumb -->
  <div class="container mt-2">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#" class="text-decoration-none text-muted">Home</a></li>
        <li class="breadcrumb-item"><a href="#" class="text-decoration-none text-muted">Shop</a></li>
        <li class="breadcrumb-item active" aria-current="page">Laptops</li>
      </ol>
    </nav>
  </div>

  <!-- Product Section -->
  <div class="container mb-5">
    <div class="row align-items-stretch">
      <div class="col-lg-6 h-100">
        <div class="zoom-container" id="prod-image">
          <% if (product.productImage && product.productImage.length > 0) { %>
            <a href="<%= product.productImage[0] %>" class="image-popup prod-img-bg">
              <img 
                src="<%= product.productImage[0] %>" 
                class="img-fluid w-100 mb-2 zoom-image" 
                style="height: 650px; object-fit: cover;" 
                alt="<%= product.productName %>" 
                id="image-sec"
              >
            </a>
            <div class="zoom-lens"></div>
          <% } else { %>
            <img 
              src="/images/placeholder.jpg" 
              class="img-fluid w-100" 
              style="height: 650px; object-fit: cover;" 
              alt="No Image Available"
            >
          <% } %>
        </div>
        <!-- Product Status -->
        <div class="product-status 
          <%= product.isLocked ? 'status-locked' : (product.quantity > 0 ? 'status-in-stock' : 'status-out-of-stock') %>">
          <%= product.isLocked ? 'Locked' : (product.quantity > 0 ? 'In Stock' : 'Out of Stock') %>
        </div>
        <div class="product-thumbs-container">
          <% if (product.productImage && product.productImage.length > 0) { %>
            <% product.productImage.forEach((image, index) => { %>
              <div class="product-thumb <%= index === 0 ? 'active' : '' %>" data-index="<%= index %>">
                <img src="<%= image || '/images/placeholder.jpg' %>" class="img-fluid" alt="Product thumbnail <%= index + 1 %>">
              </div>
            <% }) %>
          <% } else { %>
            <div class="product-thumb active">
              <img src="/images/placeholder.jpg" class="img-fluid" alt="No image available">
            </div>
          <% } %>
        </div>
      </div>
      
      <!-- Product Info -->
      <div class="col-lg-6 h-100 d-flex flex-column">
        <h1 class="fw-bold mb-1"><%= product.productName %></h1>
        <div class="d-flex align-items-center mb-2">
          <div class="rating me-2">
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star-half-alt"></i>
          </div>
          <span>4.5/5</span>
          <a href="/reviews" class="ms-2 text-decoration-none">View all reviews</a>
        </div>
        
        <div class="d-flex align-items-center mb-2">
          <h2 class="fw-bold me-2 mb-0">₹<%= product.salePrice.toLocaleString('en-IN') %></h2>
          <span class="old-price me-2">₹<%= product.regularPrice.toLocaleString('en-IN') %></span>
          <span class="discount">-20%</span>
        </div>
        
        <p class="mb-3">This high-performance laptop is perfect for any task. Crafted with premium materials and cutting-edge technology, it offers superior performance and reliability.</p>
        
        <!-- Processor Options -->
        <div class="mb-3">
          <h6 class="fw-bold mb-2">Processor: <%= product.processor %></h6>
        </div>
        
        <!-- RAM Options -->
        <div class="mb-3">
          <h6 class="fw-bold mb-2">RAM: <%= product.ram %></h6>
        </div>
        
        <!-- Storage Options -->
        <div class="mb-3">
          <h6 class="fw-bold mb-2">Storage: <%= product.Storage %></h6>
        </div>
        
        <!-- Quantity and Add to Cart -->
        <div class="d-flex flex-column mt-3 mb-3">
          <div class="d-flex align-items-center quantity-controls mb-3">
            <button class="btn-quantity" <%= product.isLocked || product.quantity === 0 ? 'disabled' : '' %>>
              <i class="fas fa-minus"></i>
            </button>
            <input type="text" value="1" class="form-control quantity-input" <%= product.isLocked || product.quantity === 0 ? 'disabled' : '' %>>
            <button class="btn-quantity" <%= product.isLocked || product.quantity === 0 ? 'disabled' : '' %>>
              <i class="fas fa-plus"></i>
            </button>
          </div>
          
          <!-- Action Buttons -->
          <div class="action-buttons">
            <button class="btn btn-cart" <%= product.isLocked || product.quantity === 0 ? 'disabled' : '' %>>Add to Cart</button>
            <button class="btn btn-buy-now" <%= product.isLocked || product.quantity === 0 ? 'disabled' : '' %>>Buy Now</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs Section -->
  <div class="container mb-5">
    <ul class="nav nav-tabs justify-content-center" id="productTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button">Product Details</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="ratings-tab" data-bs-toggle="tab" data-bs-target="#ratings" type="button">Rating & Reviews</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="faqs-tab" data-bs-toggle="tab" data-bs-target="#faqs" type="button">FAQs</button>
      </li>
    </ul>
    <div class="tab-content py-3" id="productTabsContent">
      <!-- Product Details Tab -->
      <div class="tab-pane fade show active" id="details" role="tabpanel">
        <div class="row">
          <div class="col-md-12">
            <h4 class="mb-2">Specifications</h4>
            <table class="table">
              <tbody>
                <tr>
                  <td width="30%"><strong>Processor</strong></td>
                  <td><%= product.processor %></td>
                </tr>
                <tr>
                  <td><strong>Memory</strong></td>
                  <td><%= product.ram %></td>
                </tr>
                <tr>
                  <td><strong>Storage</strong></td>
                  <td><%= product.Storage %></td>
                </tr>
                <tr>
                  <td><strong>Display</strong></td>
                  <td><%= product.display %></td>
                </tr>
                <tr>
                  <td><strong>Graphics</strong></td>
                  <td><%= product.graphicsCard %></td>
                </tr>
                <tr>
                  <td><strong>Connectivity</strong></td>
                  <td><%= product.additionalFeatures.split(', ').slice(0, 2).join(', ') %></td>
                </tr>
                <tr>
                  <td><strong>Ports</strong></td>
                  <td><%= product.additionalFeatures.split(', ').slice(2).join(', ') %></td>
                </tr>
                <tr>
                  <td><strong>Battery</strong></td>
                  <td><%= product.Battery %></td>
                </tr>
                <tr>
                  <td><strong>Weight</strong></td>
                  <td><%= product.Weight %></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Ratings Tab -->
      <div class="tab-pane fade" id="ratings" role="tabpanel">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0">All Reviews <span class="text-muted">(465)</span></h4>
          <div class="d-flex align-items-center">
            <div class="dropdown me-3">
              <button class="btn btn-sm border dropdown-toggle" type="button" data-bs-toggle="dropdown">
                Latest
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Latest</a></li>
                <li><a class="dropdown-item" href="#">Highest Rated</a></li>
                <li><a class="dropdown-item" href="#">Lowest Rated</a></li>
              </ul>
            </div>
            <button class="btn btn-outline-dark btn-sm px-3 ms-2">Write a Review</button>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <div class="review-card">
              <div class="rating mb-2">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
              </div>
              <div class="d-flex align-items-center mb-2">
                <h6 class="mb-0">Michael T.</h6>
                <span class="verified-user ms-2">
                  <i class="fas fa-check-circle"></i>
                </span>
              </div>
              <p>"This laptop exceeded my expectations! The performance is top-notch. Being a software developer, I'm quite picky about hardware specs, and this definitely gets a thumbs up."</p>
              <small class="text-muted">Posted on August 14, 2024</small>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="review-card">
              <div class="rating mb-2">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="far fa-star"></i>
              </div>
              <div class="d-flex align-items-center mb-2">
                <h6 class="mb-0">Sarah L.</h6>
                <span class="verified-user ms-2">
                  <i class="fas fa-check-circle"></i>
                </span>
              </div>
              <p>"The processing power is amazing and the display quality is incredible. Battery life could be better, but it's expected with such high performance."</p>
              <small class="text-muted">Posted on August 15, 2024</small>
            </div>
          </div>
        </div>
        
        <div class="text-center mt-3">
          <a href="/reviews" class="btn btn-outline-dark px-4">Load More Reviews</a>
        </div>
      </div>
      
      <!-- FAQs Tab -->
      <div class="tab-pane fade" id="faqs" role="tabpanel">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="accordion" id="faqAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                    What's the warranty period for this laptop?
                  </button>
                </h2>
                <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    This laptop comes with a standard 1-year manufacturer warranty. You can extend it to 3 years with our Premium Care package available at checkout.
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                    Is the RAM and storage upgradeable?
                  </button>
                </h2>
                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    Yes, both the RAM and storage are user-upgradeable. The laptop has two SODIMM slots supporting up to 64GB of RAM, and two M.2 SSD slots for storage expansion.
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                    Does it come with pre-installed software?
                  </button>
                </h2>
                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    The laptop comes with Windows 11 Home pre-installed. It also includes a 30-day trial of Microsoft Office and our own system optimization software.
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                    What's included in the box?
                  </button>
                </h2>
                <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    The package includes the laptop, a 180W power adapter, quick start guide, and warranty information.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- You Might Also Like Section -->
  <div class="container mb-5">
    <h2 class="text-center fw-bold mb-3">YOU MIGHT ALSO LIKE</h2>
    <div class="row">
        <% similerProducts.forEach(item => { %>
            <div class="col-lg-3 col-md-6 mb-4">
                <a href="/productView?id=<%= item._id %>" class="text-decoration-none text-dark">
                    <div class="product-card">
                        <img src="<%= item.productImage[0] %>" class="img-fluid mb-2" alt="<%= item.productName %>">
                        <h5><%= item.productName %></h5>
                        <div class="rating mb-2">
                            <% for(let i = 0; i < 4; i++) { %>
                                <i class="fas fa-star"></i>
                            <% } %>
                            <i class="far fa-star"></i>
                            <span class="ms-1">4.0/5</span>
                        </div>
                        <div class="d-flex justify-content-center">
                            <h5 class="fw-bold me-2">$<%= item.salePrice %></h5>
                            <% if (item.regularPrice && item.regularPrice > item.salePrice) { %>
                                <span class="old-price">$<%= item.regularPrice %></span>
                                <% const discount = Math.round(((item.regularPrice - item.salePrice) / item.regularPrice) * 100); %>
                                <span class="discount ms-2">-%<%= discount %></span>
                            <% } %>
                        </div>
                    </div>
                </a>
            </div>
        <% }) %>
    </div>
</div>

  <!-- Newsletter Section -->
  <div class="container">
    <div class="newsletter-box">
      <div class="row justify-content-center">
        <div class="col-lg-8 text-center">
          <h3 class="fw-bold mb-2">STAY UP TO DATE ABOUT OUR LATEST OFFERS</h3>
          <div class="row g-2">
            <div class="col-md-8">
              <input type="email" class="form-control" placeholder="Enter your email address">
            </div>
            <div class="col-md-4">
              <button class="btn btn-light w-100">Subscribe to Newsletter</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Include Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Include Magnific Popup JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
  
  <!-- Custom JavaScript for product interaction -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const thumbnails = document.querySelectorAll('.product-thumb');
      const mainImage = document.querySelector('.zoom-image');
      const imageLink = document.querySelector('.image-popup');

      if (!mainImage || !imageLink) {
        console.error('Main image or image link element not found');
        return;
      }

      // Thumbnail switching
      thumbnails.forEach(thumb => {
        thumb.addEventListener('click', () => {
          thumbnails.forEach(t => t.classList.remove('active'));
          thumb.classList.add('active');
          const newSrc = thumb.querySelector('img')?.src || '/images/placeholder.jpg';
          const newAlt = thumb.querySelector('img')?.alt || 'Product main image';
          mainImage.style.opacity = '0';
          setTimeout(() => {
            mainImage.src = newSrc;
            mainImage.alt = newAlt;
            imageLink.href = newSrc;
            mainImage.style.opacity = '1';
          }, 300);
        });
      });

      // Zoom functionality
      document.querySelectorAll('.zoom-container').forEach(container => {
        const img = container.querySelector('.zoom-image');
        const lens = container.querySelector('.zoom-lens');

        if (!img || !lens) {
          console.error('Zoom image or lens not found');
          return;
        }

        container.addEventListener('mousemove', (e) => {
          if (window.innerWidth <= 767) return; // Disable zoom on mobile

          const { left, top, width, height } = container.getBoundingClientRect();
          const posX = e.clientX - left;
          const posY = e.clientY - top;

          const lensX = posX - (lens.offsetWidth / 2);
          const lensY = posY - (lens.offsetHeight / 2);
          lens.style.left = `${lensX}px`;
          lens.style.top = `${lensY}px`;

          const zoomedImgUrl = img.src;
          lens.style.backgroundImage = `url(${zoomedImgUrl})`;
          lens.style.backgroundSize = `${img.width * 2}px ${img.height * 2}px`;
          lens.style.backgroundPosition = `-${posX * 2}px -${posY * 2}px`;
        });
      });

      // Initialize Magnific Popup
      $('.image-popup').magnificPopup({
        type: 'image',
        closeOnContentClick: true,
        mainClass: 'mfp-img-mobile',
        image: {
          verticalFit: true
        }
      });

      // Quantity controls
      const quantityInput = document.querySelector('.quantity-input');
      document.querySelectorAll('.btn-quantity').forEach(btn => {
        btn.addEventListener('click', function () {
          let currentValue = parseInt(quantityInput.value) || 1;
          if (this.querySelector('.fa-plus')) {
            quantityInput.value = currentValue + 1;
          } else if (this.querySelector('.fa-minus') && currentValue > 1) {
            quantityInput.value = currentValue - 1;
          }
        });
      });

      quantityInput.addEventListener('input', function () {
        let value = parseInt(this.value);
        if (isNaN(value) || value < 1) {
          this.value = 1;
        }
      });

      // Action buttons
      document.querySelector('.btn-cart').addEventListener('click', function () {
        console.log('Add to Cart clicked - would add item to cart');
      });

      document.querySelector('.btn-buy-now').addEventListener('click', function () {
        console.log('Buy Now clicked - would redirect to checkout');
      });
    });
  </script>
  <%- include("../../views/partials/user/footer") %>
</body>
</html>