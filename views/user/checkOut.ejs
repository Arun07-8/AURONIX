
<%- include("../../views/partials/user/header") %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Your Order - Checkout</title>
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <link href="/css/userside-css/userside-css/checkoutpage.css" rel="stylesheet">
</head>
<body>
    <div class="checkout-main-container">
        <!-- Breadcrumb Navigation -->
        <nav class="checkout-breadcrumb-nav">
            <a href="#">Home</a>
            <span>‚Ä∫</span>
            <a href="#">Cart</a>
            <span>‚Ä∫</span>
            <span class="checkout-breadcrumb-current">Check Out</span>
        </nav>

        <!-- Main Title -->
        <h1 class="checkout-page-title">Complete Your Order</h1>
        <div class="checkout-title-underline"></div>

        <div class="checkout-content-grid">
            <!-- Left Column -->
            <div class="checkout-left-section">
                <!-- Delivery Address Section -->
                <div class="checkout-info-section">
                    <div class="checkout-section-header">
                        <span class="checkout-section-icon">üìç</span>
                        Delivery Address
                    </div>
                    <div class="checkout-section-subtitle">Select the address for delivery</div>
                    
                    <% if (Address && Address.length > 0) { %>
                        <div id="checkout-address-list">
                            <% Address.forEach((address, index) => { %>
                                <div class="checkout-address-card <%= address.isDefault ? 'checkout-address-selected' : '' %> <%= index >= 2 ? 'checkout-address-hidden' : '' %>" data-address-id="<%= address._id %>">
                                    <div class="checkout-address-header">
                                        <div class="checkout-address-name"><%= address.name || '' %></div>
                                        <div style="display: flex; align-items: center; gap: 15px;">
                                            <% if (address.isDefault) { %>
                                                <div class="checkout-default-badge">Default</div>
                                            <% } %>
                                            <input type="radio" 
                                                   name="checkout-address" 
                                                   value="<%= address._id %>" 
                                                   class="checkout-address-radio" 
                                                   <%= address.isDefault ? 'checked' : '' %>>
                                        </div>
                                    </div>
                                    
                                    <div class="checkout-address-details">
                                        üìû <%= address.phone %><% if (address.altPhone) { %>, <%= address.altPhone %><% } %><br>
                                        üìç <%= address.fullAddress %><br>
                                        üèôÔ∏è <%= address.city %>, <%= address.state %> - <%= address.pincode %>
                                        <% if (address.landmark) { %><br>üö© <%= address.landmark %><% } %>
                                    </div>
                                    
                                    <div class="checkout-address-tags">
                                        <div class="checkout-address-tag-group">
                                            <span class="checkout-address-tag"><%= (address.addressType || 'OTHER').toUpperCase() %></span>
                                        </div>
                                        <a href="/address/edit/<%= address._id %>?from=checkout" class="checkout-edit-link">‚úèÔ∏è Edit</a>
                                    </div>
                                </div>
                            <% }) %>
                        </div>
                        
                        <% if (Address.length > 2) { %>
                            <button id="checkout-show-more-addresses" class="checkout-show-more-btn">
                                <span id="checkout-show-more-text">üìã Show More Addresses (<%= Address.length - 2 %> more)</span>
                                <span id="checkout-show-less-text" style="display: none;">üìã Show Less Addresses</span>
                            </button>
                        <% } %>
                        
                        <a href="/address/add?from=checkout" class="checkout-btn checkout-btn-dark" style="margin-top: 25px;">
                            + Add New Address
                        </a>
                    <% } else { %>
                        <div class="checkout-empty-state">
                            <p>No addresses found</p>
                            <a href="/address/add?from=checkout" class="checkout-btn checkout-btn-dark" style="margin-top: 20px;">
                                + Add New Address
                            </a>
                        </div>
                    <% } %>
                </div>

                <!-- Payment Method Section -->
                <div class="checkout-info-section">
                    <div class="checkout-section-header">
                        <span class="checkout-section-icon">üí≥</span>
                        Payment Method
                    </div>
                    
                    <div class="checkout-security-note">
                        <span class="checkout-security-icon">üîí</span>
                        All transactions are secure and encrypted
                    </div>

                    <div class="checkout-payment-option checkout-payment-selected">
                        <div class="checkout-payment-header">
                     <input type="radio" name="paymentMethod" value="Cash on Delivery" class="checkout-payment-radio" >
                            <div class="checkout-payment-icon">üíµ</div>
                            <div class="checkout-payment-name">Cash on Delivery</div>
                        </div>
                        <div class="checkout-payment-desc">
                            Pay with cash upon delivery.<br>
                            <!-- COD is only available for orders below ‚Çπ1,000. -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Order Summary -->
            <div class="checkout-order-summary">
                <div class="checkout-summary-header">
                    <span class="checkout-summary-icon">üõçÔ∏è</span>
                    Order Summary
                </div>

             <% if (Cart && Cart.items && Cart.items.length > 0) { %>

                    <!-- Dynamic Product Items -->
                    <% let subtotal = 0; %>
                    <% let totalSavings = 0; %>
                    <% Cart.items.forEach((item, index) => { %>

                        <% 
                            const regularPrice = item.productId?.regularPrice || item.salePrice;
                            const salePrice = item.salePrice;
                            const itemTotal = item.totalPrice || salePrice * item.quantity;
                            const itemSavings = (regularPrice - salePrice) * item.quantity;
                            subtotal += itemTotal;
                            totalSavings += itemSavings;
                        %>
                        <div class="checkout-product-item">
                            <div class="checkout-product-image">
                                <% if (item.productId?.productImage && item.productId.productImage.length > 0) { %>
                                    <img src="<%= item.productId.productImage[0] %>" alt="<%= item.productId.productName %>">
                                <% } else { %>
                                    <%= item.productId?.productName?.charAt(0) || 'P' %>
                                <% } %>
                            </div>
                            <div class="checkout-product-details">
                                <div class="checkout-product-name"><%= item.productId?.productName || 'Unknown Product' %></div>
                                <div class="checkout-product-meta">
                                    Size: <%= item.productId?.size || 'N/A' %> ‚Ä¢ Qty: <%= item.quantity %>
                                </div>
                                <div class="checkout-product-price">
                                    <% if (regularPrice > salePrice) { %>
                                        <span class="checkout-original-price">‚Çπ<%= regularPrice.toFixed(2) %></span>
                                    <% } %>
                                    <div class="checkout-current-price">‚Çπ<%= itemTotal.toFixed(2) %></div>
                                </div>
                            </div>
                        </div>
                    <% }) %>

                    <!-- Price Breakdown -->
                    <div class="checkout-price-breakdown">
                        <div class="checkout-price-row">
                            <span class="checkout-price-label">Subtotal</span>
                            <span class="checkout-price-value">‚Çπ<%= subtotal.toFixed(2) %></span>
                        </div>
                        <div class="checkout-price-row">
                            <span class="checkout-price-label">Savings</span>
                            <span class="checkout-price-value checkout-savings">- ‚Çπ<%= totalSavings.toFixed(2) %></span>
                        </div>
                        <div class="checkout-price-row">
                            <span class="checkout-price-label">Shipping</span>
                            <span class="checkout-price-value">‚Çπ0.00</span>
                        </div>
                    </div>

                    <div class="checkout-grand-total">
                        <span>Grand Total</span>
                        <span>‚Çπ<%= subtotal.toFixed(2) %></span>
                    </div>
                <% } else { %>
                    <div class="checkout-empty-state">
                        <p>Your cart is empty</p>
                        <a href="/products" class="checkout-btn checkout-btn-dark" style="margin-top: 20px;">
                            üõí Shop Now
                        </a>
                    </div>
                <% } %>
                <!-- Coupon Section -->
                <!-- <div class="checkout-coupon-section">
                    <div class="checkout-coupon-input">
                        <input type="text" class="checkout-coupon-field" placeholder="Enter Coupon Code" id="checkout-coupon-input">
                        <button class="checkout-apply-btn" id="checkout-apply-coupon">Apply</button>
                    </div>
                    <button class="checkout-view-coupons" id="checkout-view-coupons">üé´ View Available Coupons</button>
                </div> -->

                <!-- Place Order Button -->
                <button id="place-order" class="checkout-btn-primary" <%= Cart && Cart.items && Cart.items.length > 0 ? '' : 'disabled' %>>
                    üîí Place Order
                </button>
                <!-- Security Badge -->
                <div class="checkout-secure-checkout">
                    <span class="checkout-secure-icon">üîí</span>
                    Secure checkout
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/Javascript/userSide/checkoutpage.js"></script>
</body>
</html>
<%- include("../../views/partials/user/footer") %>

