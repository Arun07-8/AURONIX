<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Products</title>
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/css/admin-css/addprod.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
</head>
<body>
    <%- include("../../views/partials/admin/header") %>

    <div class="main-content">
        <div class="header">
            <h1 class="text-white">Edit Products</h1>
            <div class="user-profile">
                <!-- <img src="/api/placeholder/36/36" alt="User Profile"> -->
            </div>
        </div>

        <form id="editProductForm" enctype="multipart/form-data" onsubmit="return validateForm()">
            <input type="hidden" id="productId" name="productId" value="<%= product ? product._id : '' %>">
            <div class="container">
                <!-- Left Form Section -->
                <div class="form-section">
                    <h3 class="text-white mb-4">Product Details</h3>
                    <div class="form-group">
                        <label for="productName">Product Name:</label>
                        <input type="text" id="productName" name="productName" class="form-control"
                            placeholder="Enter phone model name" value="<%= product ? product.productName : '' %>">
                        <div id="productName-error" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="description">Product Description:</label>
                        <textarea id="description" name="description" class="form-control" rows="4"
                            placeholder="Enter product description"><%= product ? product.description : '' %></textarea>
                        <div id="description-error" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="brandId">Brand:</label>
                        <select name="brand" class="form-control" id="brandId">
                            <option value="" disabled>Select Brand</option>
                            <% for(let i=0; i < brand.length; i++) { %>
                                <option value="<%= brand[i]._id %>" <%= product && product.brand && product.brand._id.toString() === brand[i]._id.toString() ? 'selected' : '' %>>
                                    <%= brand[i].name %>
                                </option>
                            <% } %>
                        </select>
                        <div id="brandName-error" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="categoryId">Category:</label>
                        <select name="category" class="form-control" id="categoryId">
                            <option value="" disabled>Select Category</option>
                            <% for(let i=0; i < category.length; i++) { %>
                                <option value="<%= category[i]._id %>" <%= product && product.category && product.category._id.toString() === category[i]._id.toString() ? 'selected' : '' %>>
                                    <%= category[i].name %>
                                </option>
                            <% } %>
                        </select>
                        <div id="category-error" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="productAmount">Product Price:</label>
                        <input type="number" id="productAmount" name="regularPrice" class="form-control"
                            placeholder="Enter product price" value="<%= product ? product.regularPrice : '' %>">
                        <div id="regularPrice-error" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="offerAmount">Offer Price:</label>
                        <input type="number" id="offerAmount" name="salePrice" class="form-control"
                            placeholder="Enter offer price" value="<%= product ? product.salePrice : '' %>">
                        <div id="offerPrice-error" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="stockCount">Stock Count:</label>
                        <input type="number" id="stockCount" name="quantity" class="form-control"
                            placeholder="Enter total stock count" value="<%= product ? product.quantity : '' %>">
                        <div id="quantity-error" class="error-message"></div>
                    </div>
                </div>

                <!-- Product Specifications Section -->
                <div class="specifications-section">
                    <div class="section-header">
                        <h2 class="section-title text-white">
                            <i class="bi bi-laptop"></i>
                            Laptop Specifications
                        </h2>
                        <p class="section-subtitle text-white">Enter essential laptop specifications</p>
                    </div>
                    <div class="specs-container">
                        <!-- Core Specifications -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label required text-white">Processor</label>
                                <input type="text" class="form-control" id="processor" name="processor"
                                    placeholder="e.g., Intel Core i7-13700H, AMD Ryzen 9 7940HS" required
                                    value="<%= product && product.processor ? product.processor : '' %>">
                                <div id="processor-error" class="error-message"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required text-white">Graphics Card</label>
                                <input type="text" class="form-control" id="gpu" name="graphicsCard"
                                    placeholder="e.g., NVIDIA RTX 4060, AMD Radeon RX 7600M, Intel Iris Xe" required
                                    value="<%= product && product.graphicsCard ? product.graphicsCard : '' %>">
                                <div id="gpu-error" class="error-message"></div>
                            </div>
                        </div>
                        <!-- Memory and Storage -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label required text-white">RAM</label>
                                <input type="text" class="form-control" id="ram" name="ram"
                                    placeholder="e.g., 16GB DDR5-5200" required
                                    value="<%= product && product.ram ? product.ram : '' %>">
                                <div id="ram-error" class="error-message"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required text-white">Storage</label>
                                <input type="text" class="form-control" id="storage" name="Storage"
                                    placeholder="e.g., 1TB PCIe NVMe SSD" required
                                    value="<%= product && product.Storage ? product.Storage : '' %>">
                                <div id="storage-error" class="error-message"></div>
                            </div>
                        </div>
                        <!-- Display -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label required text-white">Display</label>
                                <input type="text" class="form-control" id="display" name="display"
                                    placeholder="e.g., 15.6 inch IPS (2560x1440) 165Hz" required
                                    value="<%= product && product.display ? product.display : '' %>">
                                <div id="display-error" class="error-message"></div>
                            </div>
                        </div>
                        <!-- Operating System -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label required text-white">Operating System</label>
                                <input type="text" class="form-control" id="os" name="operatingSystem"
                                    placeholder="e.g., Windows 11 Home, macOS Sequoia" required
                                    value="<%= product && product.operatingSystem ? product.operatingSystem : '' %>">
                                <div id="os-error" class="error-message"></div>
                            </div>
                        </div>
                        <!-- Battery and Weight -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label required text-white">Battery</label>
                                <input type="text" class="form-control" id="battery" name="Battery"
                                    placeholder="e.g., 80Wh, Up to 10 hours" required
                                    value="<%= product && product.Battery ? product.Battery : '' %>">
                                <div id="battery-error" class="error-message"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required text-white">Weight</label>
                                <input type="text" class="form-control" id="weight" name="Weight"
                                    placeholder="e.g., 1.8kg (4.0 lbs)" required
                                    value="<%= product && product.Weight ? product.Weight : '' %>">
                                <div id="weight-error" class="error-message"></div>
                            </div>
                        </div>
                        <!-- Additional Features -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label required text-white">Additional Features</label>
                                <input type="text" class="form-control" id="features" name="additionalFeatures"
                                    placeholder="e.g., Backlit Keyboard, Fingerprint Reader, 1080p Webcam" required
                                    value="<%= product && product.additionalFeatures ? product.additionalFeatures : '' %>">
                                <div id="features-error" class="error-message"></div>
                            </div>
                        </div>
                        <!-- Warranty -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label required text-white">Warranty</label>
                                <input type="text" class="form-control" id="warranty" name="Warranty"
                                    placeholder="e.g., 2 Year Limited Warranty" required
                                    value="<%= product && product.Warranty ? product.Warranty : '' %>">
                                <div id="warranty-error" class="error-message"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image Upload Section -->
                <div class="image-upload-container">
                    <h4 class="text-white">Product Images</h4>
                    <% for (let i=1; i <=4; i++) { %>
                        <div class="form-group image-item" id="imageContainer<%= i %>">
                            <label for="image<%= i %>" class="text-white">Image <%= i %></label>
                            <% if (product && product.productImage && product.productImage[i-1]) { %>
                                <div class="existing-image-container mb-3">
                                    <img src="<%=product.productImage[i-1] %>" class="existing-image"
                                        alt="Existing Image <%= i %>">
                                    <button type="button" class="btn btn-danger btn-sm mt-2"
                                        onclick="removeImage('<%= product._id %>', <%= i-1 %>)">
                                        <i class="fas fa-trash"></i> Remove
                                    </button>
                                </div>
                            <% } %>
                            <input type="file" name="image<%= i %>" id="image<%= i %>" class="form-control"
                                accept="image/png,image/jpeg,image/webp" onchange="previewImage(event, <%= i %>)">
                            <!-- Cropping Section -->
                            <div class="cropper-container" id="cropperContainer<%= i %>" style="display: none;">
                                <h5 class="text-white">Crop Image</h5>
                                <div class="cropper-wrapper">
                                    <img id="cropperImg<%= i %>" alt="Image to crop">
                                </div>
                                <!-- Aspect Ratio Selection -->
                                <div class="aspect-ratio-controls">
                                    <span class="text-white me-2">Aspect Ratio:</span>
                                    <button type="button" class="aspect-ratio-btn active" data-index="<%= i %>"
                                        data-ratio="free" onclick="setAspectRatio(<%= i %>, 'free')">
                                        Free
                                    </button>
                                    <button type="button" class="aspect-ratio-btn" data-index="<%= i %>"
                                        data-ratio="30/37" onclick="setAspectRatio(<%= i %>, 30/37)">
                                        Fit image
                                    </button>
                                </div>
                                <div class="cropper-controls">
                                    <button type="button" class="btn btn-primary" onclick="cropImage(<%= i %>)">
                                        <i class="fas fa-check"></i> Apply Crop
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="cancelCrop(<%= i %>)">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                            </div>
                            <!-- Result Preview -->
                            <div class="crop-result-container" id="previewContainer<%= i %>" style="display: none;">
                                <h5 class="text-white">Final Image</h5>
                                <img id="preview<%= i %>" src="#" alt="Image preview" class="image-preview">
                                <button type="button" class="btn btn-outline-light btn-sm mt-2"
                                    onclick="recropImage(<%= i %>)">
                                    <i class="fas fa-crop-alt"></i> Re-crop Image
                                </button>
                            </div>
                            <div id="image<%= i %>-error" class="error-message"></div>
                        </div>
                    <% } %>
                </div>
                <input type="hidden" value="<%=product._id%>" id="proID">
                <div class="button-container">
                    <button type="submit" class="add-btn">Update Product</button>
                    <a href="/products" style="text-decoration: none;color: black;">cancel</a>
                </div>
            </div>
        </form>
    </div>
    
    <script src="/Javascript/adminSide/productEdit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>